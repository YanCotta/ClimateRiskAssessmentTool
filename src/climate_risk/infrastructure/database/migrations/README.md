# Database Migrations

This directory contains database migration scripts for the Climate Risk Assessment Tool. These migrations are managed using [Alembic](https://alembic.sqlalchemy.org/).

## Directory Structure

- `versions/` - Contains individual migration scripts
- `env.py` - Migration environment configuration
- `script.py.mako` - Template for new migration files

## Creating Migrations

To create a new migration:

1. Make changes to the SQLAlchemy models in `climate_risk/infrastructure/database/models.py`
2. Generate a migration script:

```bash
alembic revision --autogenerate -m "Description of changes"
```

3. Review the generated migration script in the `versions/` directory
4. Apply the migration:

```bash
alembic upgrade head
```

## Common Commands

- `alembic current` - Show the current revision
- `alembic history` - Show migration history
- `alembic upgrade <revision>` - Upgrade to a specific revision
- `alembic downgrade <revision>` - Downgrade to a specific revision
- `alembic upgrade head` - Upgrade to the latest revision
- `alembic downgrade base` - Downgrade all migrations

## Best Practices

1. Always review autogenerated migrations before applying them
2. Write idempotent migration scripts
3. Test migrations in a development environment before applying to production
4. Keep migrations small and focused on a single change
5. Document any data migrations or special considerations in the migration script

## Version Control

- Always commit migration scripts to version control
- Never modify a migration after it has been applied to a production database
- If you need to make changes, create a new migration instead of modifying an existing one
